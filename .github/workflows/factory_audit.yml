name: Factory Audit (CI)

on:
  push:
    branches: [ main ]
  pull_request:

jobs:
  audit-factory:
    name: üè≠ Factory Inspector
    runs-on: ubuntu-latest
    steps:
      - name: ‚¨áÔ∏è Checkout Conveyor Belt
        uses: actions/checkout@v3

      - name: ‚öôÔ∏è Setup Flutter
        uses: subosito/flutter-action@v2
        with:
          channel: 'stable'

      - name: üîç Audit Modules (Raw Parts)
        run: |
          for dir in modules/*/; do
            if [ -f "$dir/pubspec.yaml" ]; then
              echo "Checking Module: $dir"
              cd "$dir"
              flutter pub get
              flutter analyze . || echo "‚ö†Ô∏è Analysis issues in $dir"
              flutter test || echo "‚ö†Ô∏è Tests failed in $dir"
              cd -
            fi
          done

      - name: üß∏ Audit Apps (Finished Toys)
        run: |
          for dir in apps/*/; do
            if [ -f "$dir/pubspec.yaml" ]; then
              echo "Checking App: $dir"
              cd "$dir"
              flutter pub get
              flutter analyze . || echo "‚ö†Ô∏è Analysis issues in $dir"
              flutter test || echo "‚ö†Ô∏è Tests failed in $dir"
              cd -
            fi
          done
